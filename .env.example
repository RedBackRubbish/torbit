# Environment variables for TORBIT
# Copy this to .env or .env.local and fill in your values

# ============================================
# AI MODEL API KEYS (at least one required)
# ============================================

# Anthropic API Key (for Claude Opus 4.6 & Sonnet 4.5)
# Used by: Architect, Frontend agents
# Get key: https://console.anthropic.com/
ANTHROPIC_API_KEY=your_anthropic_api_key_here

# Google AI API Key (for Gemini 3 Pro & Flash)
# Used by: Backend, Database, DevOps, QA agents
# Get key: https://aistudio.google.com/apikey
GOOGLE_GENERATIVE_AI_API_KEY=your_google_api_key_here

# OpenAI API Key (for Codex models)
# Used when TORBIT_USE_CODEX_PRIMARY=true
# Get key: https://platform.openai.com/api-keys
OPENAI_API_KEY=your_openai_api_key_here

# Optional OpenRouter key (used by Kimi provider fallback routing)
OPENROUTER_API_KEY=your_openrouter_api_key_here

# ============================================
# KIMI K2.5 INTELLIGENT ROUTER (Moonshot AI)
# ============================================

# Moonshot/Kimi API Key - POWERS THE INTELLIGENT ROUTER
# Kimi K2.5 is used as the master router/orchestrator for:
# - Task complexity assessment
# - Smart agent selection
# - Multimodal (vision) task detection
# - 256K context for full codebase understanding
#
# Models available:
# - kimi-k2.5: Most intelligent, multimodal, thinking mode (default)
# - kimi-k2-turbo-preview: Fast routing (60-100 tokens/sec)
# - kimi-k2-thinking: Long reasoning chains
#
# Get key: https://platform.moonshot.cn/console/api-keys
# Docs: https://platform.moonshot.cn/docs/guide/kimi-k2-5-quickstart
KIMI_API_KEY=your_kimi_api_key_here
# Alternative env var name (also works):
# MOONSHOT_API_KEY=your_kimi_api_key_here

# ============================================
# TORBIT SYSTEM CONFIGURATION
# ============================================

# Enable Kimi K2.5 intelligent routing (default: true if KIMI_API_KEY set)
TORBIT_KIMI_ROUTER=true

# Use fast routing mode (kimi-k2-turbo instead of kimi-k2.5)
# Faster but less accurate routing decisions
TORBIT_FAST_ROUTING=false

# Use Codex-first agent model map (default: false)
# When enabled, planner/architect/backend/database/frontend prefer Codex models
TORBIT_USE_CODEX_PRIMARY=false

# Supervisor/Judge model (required by orchestration contract)
# Default in code: gpt-5.2
# TORBIT_SUPERVISOR_MODEL=gpt-5.2

# Large-context analyst model
# Default in code: gemini-3-pro-preview
# TORBIT_CONTEXT_COMPILER_MODEL=gemini-3-pro-preview

# Primary builder model chain (Kimi K2.5 first)
# Default in code: moonshotai/kimi-k2.5
# TORBIT_WORKER_MODEL=moonshotai/kimi-k2.5

# Deep reviewer / critical rescue model
# Default in code: claude-opus-4-6-20260206
# TORBIT_CRITICAL_MODEL=claude-opus-4-6-20260206

# Janitor cleanup model
# Default in code: claude-sonnet-4-5-20250929
# TORBIT_JANITOR_MODEL=claude-sonnet-4-5-20250929

# Codex model override for primary orchestration (optional)
TORBIT_CODEX_MODEL=gpt-5.3-codex

# Legacy alias for Codex primary model override (optional)
# OPENAI_CODEX_MODEL=gpt-5.3-codex

# Codex model override for fast routing/execution paths (optional)
TORBIT_CODEX_FAST_MODEL=gpt-5.3-mini

# Enable autonomous error self-healing (Nervous System)
# When true, AI automatically receives and fixes errors
TORBIT_AUTO_HEAL=true

# Enable fuel consumption tracking
TORBIT_FUEL_ENABLED=true

# Default fuel allocation per session (in units)
TORBIT_DEFAULT_FUEL=500

# Chat provider circuit breaker (conversation fallback resilience)
# Trip provider after this many consecutive failures.
TORBIT_CHAT_CB_FAILURE_THRESHOLD=2

# Initial cooldown when a provider circuit opens (milliseconds).
TORBIT_CHAT_CB_COOLDOWN_MS=30000

# Maximum cooldown window for repeated provider failures (milliseconds).
TORBIT_CHAT_CB_MAX_COOLDOWN_MS=300000

# Client-side fuel bypass for testing (set to 'true' to disable fuel checks)
# NEXT_PUBLIC_FUEL_DISABLED=true

# Optional runtime persistence path for checkpoints/memory state
# TORBIT_DATA_DIR=/absolute/path/to/torbit-data

# Optional worker token for background run dispatch endpoints
# Used by: /api/background-runs/dispatch and /api/background-runs/worker
# TORBIT_WORKER_TOKEN=replace_with_long_random_secret

# Optional Vercel cron secret.
# If set in Vercel, cron requests include Authorization: Bearer <CRON_SECRET>.
# Also accepted by /api/background-runs/worker.
# CRON_SECRET=replace_with_long_random_secret

# ============================================
# OPTIONAL SERVICES
# ============================================

# Database URL (for project persistence)
# DATABASE_URL=postgresql://user:password@localhost:5432/torbit

# Redis URL (for real-time features)
# REDIS_URL=redis://localhost:6379

# Feature switches (stability-first defaults)
# Presence is opt-in and requires the project_presence table/policies.
NEXT_PUBLIC_ENABLE_PROJECT_PRESENCE=false

# Background run queue hooks can be disabled if your schema is not migrated yet.
# NEXT_PUBLIC_ENABLE_BACKGROUND_RUNS=true

# E2B API key (required only if using /api/e2b sandbox execution)
# E2B_API_KEY=your_e2b_api_key

# ============================================
# MONITORING & ERROR TRACKING (Sentry)
# ============================================

# Sentry DSN for error tracking and performance monitoring
# Get DSN: https://sentry.io/
# NEXT_PUBLIC_SENTRY_DSN=https://your-key@sentry.io/project-id
# SENTRY_DSN=https://your-key@sentry.io/project-id

# Sentry Auth Token (for source maps upload)
# SENTRY_AUTH_TOKEN=your_sentry_auth_token

# Sentry Organization and Project
# SENTRY_ORG=your-org
# SENTRY_PROJECT=torbit

# ============================================
# SUPABASE (Database + Auth)
# ============================================

# Supabase Project URL
# Get from: https://supabase.com/dashboard/project/_/settings/api
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co

# Supabase Anon Key (safe to expose)
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key

# Supabase Service Role Key (server-side only, keep secret!)
# Only needed for admin operations
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

# ============================================
# SHIPPING PROVIDERS (GitHub + Deploy)
# ============================================

# GitHub token with repo permissions.
# Used by: /api/ship/github
GITHUB_TOKEN=ghp_your_github_token

# Optional owner override for repo creation/sync.
# Defaults to the token owner's login.
# GITHUB_OWNER=your-org-or-username

# Vercel token with deploy permissions.
# Used by: /api/ship/deploy (provider=vercel)
VERCEL_TOKEN=your_vercel_token

# Optional Vercel team routing (set one if deploying to a team)
# VERCEL_TEAM_ID=team_abc123
# VERCEL_TEAM_SLUG=my-team

# Optional CI variables for canary smoke + rollback workflow
# VERCEL_PROJECT_ID=prj_xxx
# VERCEL_SCOPE=your-team-or-user

# Netlify personal access token.
# Used by: /api/ship/deploy (provider=netlify)
NETLIFY_TOKEN=your_netlify_token

# Optional existing Netlify site ID.
# If omitted, a site will be created automatically.
# NETLIFY_SITE_ID=your_site_id

# Expo token for mobile CI builds/submissions.
# Used by: /api/ship/mobile (TestFlight, App Store Connect, Android)
# Create token: https://expo.dev/accounts/[account]/settings/access-tokens
EXPO_TOKEN=your_expo_token

# Optional Apple App Store Connect authentication helpers for EAS submit:
# APPLE_APP_SPECIFIC_PASSWORD=xxxx-xxxx-xxxx-xxxx
# ASC_API_KEY_ID=AB12C3D4E5
# ASC_API_KEY_ISSUER_ID=00000000-0000-0000-0000-000000000000
# ASC_API_KEY_PATH=/absolute/path/AuthKey_AB12C3D4E5.p8
# EXPO_APPLE_APP_SPECIFIC_PASSWORD=xxxx-xxxx-xxxx-xxxx
# EXPO_ASC_API_KEY_ID=AB12C3D4E5
# EXPO_ASC_API_KEY_ISSUER_ID=00000000-0000-0000-0000-000000000000
# EXPO_ASC_API_KEY_PATH=/absolute/path/AuthKey_AB12C3D4E5.p8

# Optional Google Play service account credentials path for Android submit:
# GOOGLE_SERVICE_ACCOUNT_JSON=/absolute/path/google-service-account.json
# GOOGLE_SERVICE_ACCOUNT_KEY_PATH=/absolute/path/google-service-account.json
# EXPO_ANDROID_SERVICE_ACCOUNT_KEY_PATH=/absolute/path/google-service-account.json

# ============================================
# GOVERNANCE TRUST LAYER (Signed Audit Bundles)
# ============================================

# Required for /api/governance/sign-bundle
TORBIT_AUDIT_SIGNING_SECRET=replace_with_long_random_secret

# Optional key id included in signature metadata
TORBIT_AUDIT_SIGNING_KEY_ID=torbit-default

# Legacy alias (still supported)
# TORBIT_SIGNING_SECRET=replace_with_long_random_secret

# ============================================
# STRIPE (Payments & Subscriptions)
# ============================================

# Stripe Secret Key (server-side only!)
# Get from: https://dashboard.stripe.com/apikeys
STRIPE_SECRET_KEY=sk_test_your_stripe_secret_key

# Stripe Publishable Key (safe to expose)
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_your_stripe_publishable_key

# Stripe Webhook Secret (for verifying webhook signatures)
# Get from: https://dashboard.stripe.com/webhooks
STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret

# Stripe Product/Price IDs (set these after creating products in Stripe Dashboard)
# Subscriptions
STRIPE_PRICE_PRO_MONTHLY=price_pro_monthly_id
STRIPE_PRICE_TEAM_MONTHLY=price_team_monthly_id

# Fuel Packs (one-time)
STRIPE_PRICE_FUEL_500=price_fuel_500_id
STRIPE_PRICE_FUEL_2500=price_fuel_2500_id
STRIPE_PRICE_FUEL_10000=price_fuel_10000_id
